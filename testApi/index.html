<!DOCTYPE >
<html >
<head>
<title>CHAT</title>
<link type="text/css" rel="stylesheet" href="style.css" />
</head>
 
<div id="wrapper">
    <div id="menu">
        <p class="welcome">WITAMY NA CHACIE <b></b></p>
        <p class="logout"><a id="exit" href="#">Opusc czat</a></p>
        <div style="clear:both"></div>
    </div>
     
    <div id="chatbox"></div>
     
    <form name="wiadomosc" action="">
        <input name="wiadom" type="text" id="wiadom" size="55" />
        <input name="submit" type="submit"  id="submit" value="Wyslij wiadomosc" />
    </form>
</div>

</body>
</html>

<script src="/socket.io/socket.io.js"></script>

<script>
	//przenieść caly ponizszy kod do zewnetrznego pliku

	var form = document.getElementById('form');		//zapisanie formularza jako zmienna
	
	var socket = io.connect();	//ustanowienie polaczenia socket.io
	
	
	form.onsubmit = function(e)
	{
		//wykonuje się w momencie zaakceptowania formularza (po nacisnieciu przycisku)
		
		var text = document.getElementById('inputText');	//zapisanie pola tekstowego jako zmienna
		e.preventDefault();	//blokada przeładowywania strony po zaakceptowaniu formularza
				
		var http = new XMLHttpRequest();	//utworzenie obiektu żądania
		var url = '/sendMessage';	//okreslenie adresu POST
		
		var params = 'text=' + text.value;	//tworzenie tresci przekazywanej za pomoca POST
		http.open("POST", url, true);	//ustanowienie polaczenia
		
		http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");	//konfiguracja żądania
		
		http.onreadystatechange = function()
		{
			if(http.readyState == 4 && http.status == 200)
			{
				//reakcja na odpowiedź na żądanie
				alert(http.response);
			}
		}
		
		http.send(params);	//przesyłanie żądania
	}
	
	socket.on('newMessage', function(message)
	{	
		//wywoluje się w momencie otrzymania nowej wiadomosci
		
		console.log('socket - ' + message);
	});
</script>